{% load i18n %}
{% load staticfiles %}

<!-- Preloader for load detail -->
<div layout="row" layout-sm="column" layout-align="space-around" ng-if="!itemDetailLoad">
    <md-progress-circular md-mode="indeterminate"></md-progress-circular>
</div>

<div class="wrapperOnList col-lg-12 col-md-12 col-sm-12 col-xs-12" ng-if="itemDetailLoad">
    <div class="row">

        <h1 class="item-detail-name col-lg-12 col-md-12 col-sm-12 col-xs-12">[[ itemDetail.name ]]</h1>

        <!-- breadcrumb -->
        <ol class="breadcrumb">
            <li><a href="{% url 'home' %}">{% trans "Home" %}</a></li>
            <li><a href="{% url 'products_index_ang' %}#/products"
                   ng-click="showDetailOfItem=false">{% trans "List of items" %}</a></li>
            <li ng-show="showDetailOfItem" class="active">{% trans "Detail of item" %}</li>
        </ol>
        <hr>

        <md-content>
            <md-tabs md-dynamic-height md-border-bottom>

                <!-- Item-detail tab -->
                <md-tab label="description">
                    <md-content class="md-padding">
                        <!-- ID block -->
                        <div class="col-lg-10 col-md-9 col-sm-9 col-xs-6">
                            <h3 class="detail-item-attr">
                                <small>
                                    {% trans "ID:" %}[[ itemDetail.id ]]
                                </small>
                            </h3>
                        </div>

                        <!-- Button dropdown -->
                        <div class="col-lg-2 col-md-3 col-sm-3 col-xs-6 text-right" ng-if="isAuthUserIsOwner()">
                            <div class="btn-group">
                                <a class="btn btn-primary" ng-href="#/products/[[ itemDetail.id ]]/edit">
                                    {% trans "Edit" %}
                                </a>
                                <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                                   href="javascript:void(0);">
                                    <span class="fa fa-caret-down"></span></a>
                                <ul class="dropdown-menu">
                                    <li><a ng-href="#/products/[[ itemDetail.id ]]/edit"> {% trans "Edit" %}</a></li>
                                    <li>
                                        <a ng-href="#/products/[[ itemDetail.id ]]/action/add"> {% trans "Add/edit action" %}</a>
                                    </li>
                                    <li><a href="javascript:;" class="alert-danger"
                                           ng-click="deleteItem()">{% trans "Delete" %}</a></li>
                                    <li class="divider"></li>
                                    <li><a href="{% url 'products_add' %}">
                                        <i class="i"></i> {% trans "Add item" %}</a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Image block -->
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-12 text-center animated fadeInLeft">
                            <a ng-href="[[ itemDetail.image_url ]]" ng-if="itemDetail.image_url.length">
                                <img ng-src="[[ itemDetail.image_url ]]"
                                     class="img-rounded img-responsive" alt="item-image">
                            </a>
                            <img src="{% static "products/images/no-image.png" %}"
                                 class="img-rounded img-responsive" alt="item-image"
                                 ng-if="!itemDetail.image_url.length">
                        </div>

                        <!-- Price and action price -->
                        <div class="col-lg-8 col-md-6 col-sm-8 col-xs-12 animated fadeInRight">

                            <div class="row" ng-if="itemDetail.action">
                                <div class="action-block col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <h4>{% trans "Action ended at:" %}</h4>

                                    <div class="clock">[[ itemDetail.action.period_to | date:"medium"]]</div>

                                    <!-- Accordion for sort by category -->
                                    <div class="action-accordion col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                                        <accordion close-others="oneAtATime">
                                            <accordion-group heading="Read more" is-open="false"
                                                             is-disabled="status.isFirstDisabled"
                                                             popover="Click to read more about this action"
                                                             popover-trigger="mouseenter">
                                                <pre>[[ itemDetail.action.description ]]</pre>

                                            </accordion-group>
                                        </accordion>
                                    </div>

                                    <!-- Price with action -->
                                    <h3>{% trans "Price:" %}
                                        <span ng-class="{'oldprice' : itemDetail.action.new_price}">
                                            [[ itemDetail.price | currency:"₴" ]]
                                        </span>

                                                            <!-- show new price if it defined in action -->
                                        <span class="newprice animated infinite pulse" ng-if="itemDetail.action.new_price">
                                            [[ itemDetail.action.new_price| currency:"₴"  ]]
                                        </span>
                                    </h3>
                                </div>
                            </div>

                            <!-- Categories -->
                            <md-chips ng-model="itemDetail.categories" readonly="true"></md-chips>

                            <!-- Price without action -->
                            <div ng-hide="itemDetail.action">
                                <h3>{% trans "Price:" %}
                                    <span>[[ itemDetail.price | currency:"₴" ]]</span>
                                </h3>
                            </div>


                            <!-- Rating block-->
                            <h4 ng-hide="greet">{% trans "Average rating:" %}
                                <rating ng-model="rate.value" max="max" readonly="isReadonly"
                                        on-hover="hoveringOver(value)"
                                        on-leave="overStar = null" titles="['one','two','three']"
                                        ng-click="isReadonly=true;addRate();">

                                </rating>
                            </h4>
                            <h4 class="rate-success-text" ng-if="greet">{% trans "Thanks for rate" %}</h4>

                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" ng-if="isReadonly">
                                <progressbar max="maxx" value="dynamic" class="col-lg-3 col-md-4 col-sm-5 col-xs-6">
                                    <span class="progressbar-text">[[dynamic]] / [[maxx]]</span>
                                </progressbar>
                            </div>

                            <!-- Description -->
                            <div class="item-detail-description col-lg-12 col-md-12 col-sm-12 col-xs-12 hidden-sm">
                                <pre>[[ itemDetail.description ]]</pre>
                            </div>

                        </div>

                        <!-- Description for sm-display-->
                        <div class="item-detail-description col-sm-12 hidden-lg hidden-md hidden-xs">
                            <pre>[[ itemDetail.description ]]</pre>
                        </div>
                    </md-content>
                </md-tab>

                <!-- Comments tab -->
                <md-tab label="comments">
                    <md-content class="md-padding">

                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 ">
                            <!-- show comments if they exists for this item -->
                            <h3 id="comments" ng-show="itemDetail.comments.length">{% trans "Comments" %}</h3>
                        </div>
                        <div class="button-add-something col-lg-6 col-md-6 col-sm-6 col-xs-6 text-right">
                            <button ng-click="scrollTo('add-comment-form')"
                                    class="btn btn-default">{% trans "Add comment" %}</button>
                        </div>

                        <!-- block for new comment posting by user -->
                        <div class="comment-unit col-md-8 col-sm-10 animated slideInUp" ng-show="appendComment">
                            <h3>
                                [[ appendComment.username ]]
                                <small>[[appendComment.created_at | date:'medium']]</small>
                            </h3>
                            <pre>[[ appendComment.message ]]</pre>
                        </div>

                        <!-- ng-repeat comments -->
                        <div class="comments-wrapper">
                            <div class="comment-unit col-md-8 col-sm-10"
                                 ng-repeat="comment in itemDetail.comments | startFrom:(currentPage - 1) * pageSize | limitTo:pageSize">
                                <h4>
                                    [[ comment.username ]]
                                    <small>[[comment.created_at | date:'medium']]</small>
                                </h4>
                                <pre>[[ comment.message ]]</pre>
                            </div>
                        </div>

                        <!-- angular pagination for comments -->
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center"
                             ng-hide="itemDetail.comments.length">
                            <h3>{% trans "Comments not added yet :(" %}</h3>
                        </div>

                        <!-- angular pagination for comments -->
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center" ng-show="isCommentsLengthBiggerThenPagesize()">
                            <pagination total-items="itemDetail.comments.length" ng-model="currentPage"
                                        items-per-page="pageSize"></pagination>
                        </div>


                        <!-- Comment form with errors -->
                        <div class="comment-form col-md-8 col-sm-10">

                            <h1 ng-hide="hideCommentForm">
                                <small>{% trans "Add comment" %}</small>
                            </h1>

                            <!-- Error blocks -->
                            <h4 class="error-comment-message" ng-show="errorComment.data.username">
                                {% trans "Username:" %}
                                <ul>
                                    <li ng-repeat="error in errorComment.data.username">
                                        [[ error ]]
                                    </li>
                                </ul>
                            </h4>

                            <h4 class="error-comment-message" ng-show="errorComment.data.message">
                                {% trans "Message:" %}
                                <ul>
                                    <li ng-repeat="error in errorComment.data.message">
                                        [[ error ]]
                                    </li>
                                </ul>
                            </h4>

                            <!-- form form add new comments-->
                            <form class="form-horizontal ng-pristine ng-valid" name="add_comment_form" role="form"
                                  method="POST"
                                  ng-submit="addComment()" ng-hide="hideCommentForm" id="add-comment-form">

                                <div class="form-group"><label class="col-md-2 control-label"
                                                               for="id_username">{% trans "Username" %}</label>

                                    <div class="col-md-7"><input class="form-control" id="id_username" maxlength="50"
                                                                 name="username"
                                                                 placeholder="username" required="required" title=""
                                                                 type="text" ng-model="comment.username"></div>
                                </div>

                                <div class="form-group"><label class="col-md-2 control-label"
                                                               for="id_message">{% trans "Message" %}</label>

                                    <div class="col-md-7"><textarea class="form-control" cols="40" id="id_message"
                                                                    name="message"
                                                                    placeholder="message" required="required" rows="10"
                                                                    title="" ng-model="comment.message"></textarea>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-md-6 col-md-offset-2 text-center">
                                        <button type="submit" class="btn btn-primary"
                                                name="submit">{% trans "Add comment" %}</button>
                                    </div>
                                </div>

                            </form>

                            <!-- Success message block -->
                            <div class="alert alert-success text-center" ng-show="hideCommentForm">
                                <button type="button" class="close" data-dismiss="alert"
                                        aria-hidden="true">&times;</button>
                                {% trans "Thanks for comment!" %}
                            </div>

                        </div>
                    </md-content>
                </md-tab>
            </md-tabs>
        </md-content>


        <!-- Flash error messages -->
        <div class="col-lg-12">
            <div flash-message="4000"></div>
        </div>

    </div>
</div>